<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>InnoSearch - 기술 상세</title>
  <link rel="stylesheet" href="./css/styles.css" />
  <style>
    body{ background:linear-gradient(180deg, #0e1330 0%, #0b1020 100%); }
    .section{ padding: 32px 0; }
    .container{ width:min(1100px,92%); margin:0 auto; }
    .card{
      background:#fff; border:1px solid #e5e7eb; border-radius:16px; padding:20px;
      box-shadow: 0 6px 16px rgba(0,0,0,.06); color:#111827;
    }
    h1{ margin:0 0 8px; font-size:24px; color:#111827; }
    .meta{ color:#6b7280; margin-bottom:16px; }
    table{ width:100%; border-collapse:collapse; }
    th, td{ text-align:left; border-bottom:1px solid #f1f5f9; padding:10px 8px; color:#111827; }
    th{ width:280px; color:#374151; font-weight:700; background:#f9fafb; }

    /* 버튼 스타일 추가 (기존 styles.css에 .btn이 있지만, 여기서도 정의해 만일의 경우 대비) */
    #paper-search-actions .btn {
        display: inline-block;
        padding: 8px 15px;
        margin: 5px 10px 5px 0;
        background-color: #2563eb;
        color: white;
        text-decoration: none;
        border-radius: 8px;
        font-weight: bold;
        transition: background-color 0.2s;
    }
    #paper-search-actions .btn:hover {
        background-color: #1d4ed8;
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="container nav">
      <a class="brand" href="./home.html">
        <span class="logo" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="24" height="24">
            <path d="M12 2l8.66 5v10L12 22l-8.66-5V7z" fill="currentColor" opacity=".12"/>
            <path d="M12 6l6.06 3.5v7L12 20l-6.06-3.5v-7z" fill="currentColor"/>
          </svg>
        </span>
        <span class="brand-text">InnoSearch</span>
      </a>
      <nav class="menu" aria-label="주요 메뉴">
        <a href="./matching.html">기술/분야</a>
        <a href="./goodex.html">우수사례</a>
        <a href="./organ.html">창업시설</a>
        <a href="./board.html">게시판</a>
      </nav>
      <div class="nav-actions">
        <a class="link" id="btn-login"  href="./login.html">로그인</a>
        <a class="btn primary" id="btn-signup" href="./signup.html">회원가입</a>
        <a class="link" id="btn-mypage" href="./myLab.html" style="display:none;">마이페이지</a>
        <a class="link" id="btn-logout" href="#" style="display:none;">로그아웃</a>
        <span id="user-display" style="display:none; margin-right:10px; color:#cbd5e1;"></span>
      </div>
    </div>
  </header>

  <main class="section">
    <div class="container">
      <div class="card">
        <h1 id="techName">기술명</h1>
        <div class="meta" id="techMeta">데이터 소스: -</div>
        <div class="table-wrap">
          <table id="detailTable">
            <tbody></tbody>
          </table>
        </div>
        <div id="paper-search-actions" style="margin-top: 20px;">
        <h4>관련 논문 검색 🔎</h4>
        </div>
      </div>
      </div>
    </div>
  </main>

  <footer class="site-header"> <div class="container foot">
      <div class="brand lite">
        <span class="logo" aria-hidden="true">
          <svg viewBox="0 0 24 24" width="24" height="24">
            <path d="M12 2l8.66 5v10L12 22l-8.66-5V7z" fill="currentColor" opacity=".12" />
            <path d="M12 6l6.06 3.5v7L12 20l-6.06-3.5v-7z" fill="currentColor" />
          </svg>
        </span>
        <span class="brand-text">InnoSearch</span>
      </div>
      <div class="foot-right">
        <a href="#">이용약관</a>
        <a href="#">개인정보처리방침</a>
        <a href="#">고객센터</a>
      </div>
    </div>
  </footer>

  <script src="./js/apiClient.js"></script>
  <script src="./js/session.js"></script>

  <script>
    const esc = s => String(s ?? '')
      .replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;')
      .replaceAll('"','&quot;').replaceAll("'",'&#39;');

    document.addEventListener('DOMContentLoaded', () => {
      const dataRaw = localStorage.getItem('selectedTechFull');
      if (!dataRaw) {
        document.getElementById('techName').textContent = '선택된 기술이 없습니다.';
        document.getElementById('techMeta').textContent  = '';
        return;
      }

      const data = JSON.parse(dataRaw);
      const techName = data.name || '기술 상세'; // 기술명 추출
      document.getElementById('techName').textContent = techName;
      document.getElementById('techMeta').textContent = `데이터 소스: ${data.source || '-'}`;

      const tbody = document.querySelector('#detailTable tbody');
      tbody.innerHTML = '';
      const fields = data.fields || {};

      Object.entries(fields).forEach(([key, val]) => {
        const tr = document.createElement('tr');
        tr.innerHTML = `<th>${esc(key)}</th><td>${esc(val ?? '')}</td>`;
        tbody.appendChild(tr);
      });

      // ===== ✅ 논문 검색 버튼 생성 코드 시작 =====
      const paperSearchActions = document.getElementById('paper-search-actions');
      const encodedTechName = encodeURIComponent(techName);

      const searchEngines = {
        'Google Scholar': `https://scholar.google.com/scholar?q=${encodedTechName}`,
        'RISS': `http://www.riss.kr/search/Search.do?isDetailSearch=N&searchGubun=true&viewYn=OP&query=${encodedTechName}`,
        'DBpia': `https://www.dbpia.co.kr/search/topSearch?startCount=0&collection=ALL&searchField=ALL&sort=RANK&query=${encodedTechName}&prevQuery=${encodedTechName}`
      };

      for (const [engineName, url] of Object.entries(searchEngines)) {
        const button = document.createElement('a');
        button.href = url;
        button.textContent = `${engineName}에서 검색`;
        button.target = '_blank'; // 새 탭에서 열기
        button.className = 'btn'; // 스타일 적용
        paperSearchActions.appendChild(button);
      }
      // ===== 논문 검색 버튼 생성 코드 끝 =====
    });
  </script>
</body>
</html>